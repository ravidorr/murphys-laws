name: iOS CI

on:
  push:
    paths:
      - 'ios/**'
      - '.github/workflows/ios-ci.yml'
  pull_request:
    paths:
      - 'ios/**'

jobs:
  build-and-test:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable

      - name: Check for Xcode project
        id: check_project
        run: |
          if [ -f "ios/MurphysLaws.xcodeproj/project.pbxproj" ]; then
            echo "exists=true" >> $GITHUB_OUTPUT
          else
            echo "exists=false" >> $GITHUB_OUTPUT
          fi

      - name: Build (if project exists)
        if: steps.check_project.outputs.exists == 'true'
        run: |
          cd ios
          xcodebuild build \
            -project MurphysLaws.xcodeproj \
            -scheme MurphysLaws \
            -destination 'platform=iOS Simulator,name=iPhone SE (3rd generation)'

      - name: Test (if project exists)
        if: steps.check_project.outputs.exists == 'true'
        run: |
          cd ios
          xcodebuild test \
            -project MurphysLaws.xcodeproj \
            -scheme MurphysLaws \
            -destination 'platform=iOS Simulator,name=iPhone SE (3rd generation)'

      - name: Skip (project not yet created)
        if: steps.check_project.outputs.exists == 'false'
        run: echo "iOS project not yet created. Skipping build."

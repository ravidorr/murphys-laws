/* ==========================
   Dark Mode Theme
   ========================== */

/* 
 * Theme implementation supports three modes:
 * 1. Auto (default): Uses @media (prefers-color-scheme: dark) 
 * 2. Manual dark: Uses [data-theme="dark"] on :root
 * 3. Manual light: Uses [data-theme="light"] on :root (prevents dark mode)
 * 
 * Priority: data-theme attribute > system preference
 */

/* Mixin-like approach: define dark mode styles once, apply via both selectors */

/* Auto mode: follows system preference */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) {
    --bg: var(--dark-bg-primary);
    --fg: var(--dark-fg-primary);
    --muted-fg: var(--dark-muted-fg);
    --border: var(--dark-border);
    --primary: var(--dark-primary);
    --text-high-contrast: var(--dark-text-high-contrast);
  }
}

/* Manual dark mode override */
:root[data-theme="dark"] {
  --bg: var(--dark-bg-primary);
  --fg: var(--dark-fg-primary);
  --muted-fg: var(--dark-muted-fg);
  --border: var(--dark-border);
  --primary: var(--dark-primary);
  --text-high-contrast: var(--dark-text-high-contrast);
}

/* Dark mode component styles - apply when dark variables are active */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) a { color: var(--dark-link); }
  :root:not([data-theme="light"]) a:visited { color: var(--dark-link-visited); }

  :root:not([data-theme="light"]) a:hover,
  :root:not([data-theme="light"]) a:focus-visible { color: var(--dark-link-hover); }
}

:root[data-theme="dark"] a { color: var(--dark-link); }
:root[data-theme="dark"] a:visited { color: var(--dark-link-visited); }

:root[data-theme="dark"] a:hover,
:root[data-theme="dark"] a:focus-visible { color: var(--dark-link-hover); }

/* Header - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) header.sticky {
    background: color-mix(in oklab, var(--bg) 86%, transparent);
    border-bottom-color: var(--border);
  }
}

:root[data-theme="dark"] header.sticky {
  background: color-mix(in oklab, var(--bg) 86%, transparent);
  border-bottom-color: var(--border);
}

/* Brand badge - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .brand-badge {
    background: var(--primary);
    color: var(--white);
    box-shadow: 0 0 0 1px rgb(255 255 255 / 14%), 0 4px 16px var(--shadow-dark);
  }

  :root:not([data-theme="light"]) .brand-badge::before {
    background: var(--white);
    color: var(--primary);
    box-shadow: 0 2px 8px var(--shadow-dark);
  }

  :root:not([data-theme="light"]) .brand-badge:hover {
    box-shadow: 0 4px 12px var(--shadow-blue-dark), 0 0 0 1px rgb(255 255 255 / 14%);
  }
}

:root[data-theme="dark"] .brand-badge {
  background: var(--primary);
  color: var(--white);
  box-shadow: 0 0 0 1px rgb(255 255 255 / 14%), 0 4px 16px var(--shadow-dark);
}

:root[data-theme="dark"] .brand-badge::before {
  background: var(--white);
  color: var(--primary);
  box-shadow: 0 2px 8px var(--shadow-dark);
}

:root[data-theme="dark"] .brand-badge:hover {
  box-shadow: 0 4px 12px var(--shadow-blue-dark), 0 0 0 1px rgb(255 255 255 / 14%);
}

/* Cards - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .card {
    background: color-mix(in oklab, var(--bg) 88%, white 12%);
    border-color: var(--border);
    box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
  }

  :root:not([data-theme="light"]) .section-card {
    background: color-mix(in oklab, var(--bg) 88%, white 12%);
    box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
  }

  :root:not([data-theme="light"]) .law-detail .card {
    background: color-mix(in oklab, var(--bg) 88%, white 12%);
    box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
  }
}

:root[data-theme="dark"] .card {
  background: color-mix(in oklab, var(--bg) 88%, white 12%);
  border-color: var(--border);
  box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
}

:root[data-theme="dark"] .section-card {
  background: color-mix(in oklab, var(--bg) 88%, white 12%);
  box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
}

:root[data-theme="dark"] .law-detail .card {
  background: color-mix(in oklab, var(--bg) 88%, white 12%);
  box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
}

/* Footer - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .footer {
    background: color-mix(in oklab, var(--bg) 90%, white 10%);
    border-top-color: var(--border);
  }

  :root:not([data-theme="light"]) .section-footer,
  :root:not([data-theme="light"]) .card-footer,
  :root:not([data-theme="light"]) .law-detail .law-meta {
    background: color-mix(in oklab, var(--bg) 86%, white 14%);
    border-top-color: var(--border);
  }
}

:root[data-theme="dark"] .footer {
  background: color-mix(in oklab, var(--bg) 90%, white 10%);
  border-top-color: var(--border);
}

:root[data-theme="dark"] .section-footer,
:root[data-theme="dark"] .card-footer,
:root[data-theme="dark"] .law-detail .law-meta {
  background: color-mix(in oklab, var(--bg) 86%, white 14%);
  border-top-color: var(--border);
}

/* Buttons - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .btn,
  :root:not([data-theme="light"]) button {
    box-shadow: 0 0 0 1px rgb(255 255 255 / 8%) inset;
  }

  :root:not([data-theme="light"]) .btn.outline,
  :root:not([data-theme="light"]) button.outline {
    background: color-mix(in oklab, var(--bg) 86%, white 14%);
    border-color: rgb(255 255 255 / 22%);
  }

  :root:not([data-theme="light"]) .btn.outline:hover,
  :root:not([data-theme="light"]) button.outline:hover,
  :root:not([data-theme="light"]) .btn.outline:focus-visible,
  :root:not([data-theme="light"]) button.outline:focus-visible {
    background: color-mix(in oklab, var(--bg) 80%, white 20%);
    border-color: rgb(255 255 255 / 32%);
  }
}

:root[data-theme="dark"] .btn,
:root[data-theme="dark"] button {
  box-shadow: 0 0 0 1px rgb(255 255 255 / 8%) inset;
}

:root[data-theme="dark"] .btn.outline,
:root[data-theme="dark"] button.outline {
  background: color-mix(in oklab, var(--bg) 86%, white 14%);
  border-color: rgb(255 255 255 / 22%);
}

:root[data-theme="dark"] .btn.outline:hover,
:root[data-theme="dark"] button.outline:hover,
:root[data-theme="dark"] .btn.outline:focus-visible,
:root[data-theme="dark"] button.outline:focus-visible {
  background: color-mix(in oklab, var(--bg) 80%, white 20%);
  border-color: rgb(255 255 255 / 32%);
}

/* Inputs - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) input[type='text'],
  :root:not([data-theme="light"]) input[type='email'],
  :root:not([data-theme="light"]) textarea,
  :root:not([data-theme="light"]) select,
  :root:not([data-theme="light"]) .form-control,
  :root:not([data-theme="light"]) .share-form-container .form-group textarea,
  :root:not([data-theme="light"]) .share-form-container .form-group input {
    background: color-mix(in oklab, var(--bg) 92%, white 8%);
    color: var(--fg);
    border: 1.5px solid rgb(255 255 255 / 25%);
  }

  :root:not([data-theme="light"]) input[type='text']:hover,
  :root:not([data-theme="light"]) input[type='email']:hover,
  :root:not([data-theme="light"]) textarea:hover,
  :root:not([data-theme="light"]) select:hover,
  :root:not([data-theme="light"]) .form-control:hover,
  :root:not([data-theme="light"]) .share-form-container .form-group textarea:hover,
  :root:not([data-theme="light"]) .share-form-container .form-group input:hover {
    border-color: rgb(255 255 255 / 35%);
  }

  :root:not([data-theme="light"]) .submit-checkbox-group input[type="checkbox"] {
    background: color-mix(in oklab, var(--bg) 92%, white 8%);
    border: 1.5px solid rgb(255 255 255 / 25%);
  }
}

:root[data-theme="dark"] input[type='text'],
:root[data-theme="dark"] input[type='email'],
:root[data-theme="dark"] textarea,
:root[data-theme="dark"] select,
:root[data-theme="dark"] .form-control,
:root[data-theme="dark"] .share-form-container .form-group textarea,
:root[data-theme="dark"] .share-form-container .form-group input {
  background: color-mix(in oklab, var(--bg) 92%, white 8%);
  color: var(--fg);
  border: 1.5px solid rgb(255 255 255 / 25%);
}

:root[data-theme="dark"] input[type='text']:hover,
:root[data-theme="dark"] input[type='email']:hover,
:root[data-theme="dark"] textarea:hover,
:root[data-theme="dark"] select:hover,
:root[data-theme="dark"] .form-control:hover,
:root[data-theme="dark"] .share-form-container .form-group textarea:hover,
:root[data-theme="dark"] .share-form-container .form-group input:hover {
  border-color: rgb(255 255 255 / 35%);
}

:root[data-theme="dark"] .submit-checkbox-group input[type="checkbox"] {
  background: color-mix(in oklab, var(--bg) 92%, white 8%);
  border: 1.5px solid rgb(255 255 255 / 25%);
}

/* Content cards - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .content-card {
    background: color-mix(in oklab, var(--bg) 88%, white 12%);
    border-color: var(--border);
    box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
  }
}

:root[data-theme="dark"] .content-card {
  background: color-mix(in oklab, var(--bg) 88%, white 12%);
  border-color: var(--border);
  box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
}

/* Navigation dropdown - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .nav-dropdown {
    background: color-mix(in oklab, var(--bg) 88%, white 12%);
    box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
  }
}

:root[data-theme="dark"] .nav-dropdown {
  background: color-mix(in oklab, var(--bg) 88%, white 12%);
  box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 8px 24px var(--shadow-dark);
}

/* Search field select dropdowns - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .search-field select {
    background-color: color-mix(in oklab, var(--bg) 92%, white 8%);
    box-shadow: 0 1px 3px var(--shadow-dark);
  }

  :root:not([data-theme="light"]) .search-field select:hover {
    background-color: color-mix(in oklab, var(--bg) 88%, white 12%);
    box-shadow: 0 2px 6px var(--shadow-dark);
  }

  :root:not([data-theme="light"]) .search-field select:focus {
    box-shadow: 0 0 0 3px color-mix(in oklab, var(--btn-primary-bg) 30%, transparent 70%);
  }
}

:root[data-theme="dark"] .search-field select {
  background-color: color-mix(in oklab, var(--bg) 92%, white 8%);
  box-shadow: 0 1px 3px var(--shadow-dark);
}

:root[data-theme="dark"] .search-field select:hover {
  background-color: color-mix(in oklab, var(--bg) 88%, white 12%);
  box-shadow: 0 2px 6px var(--shadow-dark);
}

:root[data-theme="dark"] .search-field select:focus {
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--btn-primary-bg) 30%, transparent 70%);
}

/* Modal - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .modal-content {
    background: color-mix(in oklab, var(--bg) 88%, white 12%);
    box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 20px 60px rgb(0 0 0 / 50%);
  }
}

:root[data-theme="dark"] .modal-content {
  background: color-mix(in oklab, var(--bg) 88%, white 12%);
  box-shadow: 0 1px 0 rgb(255 255 255 / 6%) inset, 0 20px 60px rgb(0 0 0 / 50%);
}

/* Voting buttons - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) button[data-vote='down']:hover {
    filter: saturate(1.2) brightness(1.2);
  }
}

:root[data-theme="dark"] button[data-vote='down']:hover {
  filter: saturate(1.2) brightness(1.2);
}

/* Pagination - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .pagination .btn[aria-current='page'] {
    background: var(--btn-primary-bg);
    border-color: var(--btn-primary-bg);
    color: var(--btn-primary-fg);
    box-shadow: 0 4px 14px var(--shadow-blue-dark);
  }

  :root:not([data-theme="light"]) .pagination .btn:hover {
    filter: brightness(1.08);
  }
}

:root[data-theme="dark"] .pagination .btn[aria-current='page'] {
  background: var(--btn-primary-bg);
  border-color: var(--btn-primary-bg);
  color: var(--btn-primary-fg);
  box-shadow: 0 4px 14px var(--shadow-blue-dark);
}

:root[data-theme="dark"] .pagination .btn:hover {
  filter: brightness(1.08);
}

/* Blockquote - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .blockquote {
    border-left-color: color-mix(in oklab, var(--btn-primary-bg) 85%, white 15%);
    background: color-mix(in oklab, var(--bg) 88%, white 12%);
  }
}

:root[data-theme="dark"] .blockquote {
  border-left-color: color-mix(in oklab, var(--btn-primary-bg) 85%, white 15%);
  background: color-mix(in oklab, var(--bg) 88%, white 12%);
}

/* Calculator semantic states - dark mode */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .calc-ok {
    background: var(--dark-success-bg);
    color: var(--dark-success-fg);
  }

  :root:not([data-theme="light"]) .calc-warn {
    background: var(--dark-warning-bg);
    color: var(--dark-warning-fg);
  }

  :root:not([data-theme="light"]) .calc-orange {
    background: var(--dark-orange-bg);
    color: var(--dark-orange-fg);
  }

  :root:not([data-theme="light"]) .calc-danger {
    background: var(--dark-error-bg);
    color: var(--dark-error-fg);
  }

  :root:not([data-theme="light"]) .calc-dark {
    background: var(--dark-dark-bg);
    color: var(--dark-dark-fg);
  }

  :root:not([data-theme="light"]) .sod-simple-value {
    color: var(--dark-link-hover);
  }

  /* Slider values need higher contrast in dark mode (WCAG AA 4.5:1) */
  :root:not([data-theme="light"]) .calc-slider-value {
    color: #a5b4fc;
  }
}

:root[data-theme="dark"] .calc-ok {
  background: var(--dark-success-bg);
  color: var(--dark-success-fg);
}

:root[data-theme="dark"] .calc-warn {
  background: var(--dark-warning-bg);
  color: var(--dark-warning-fg);
}

:root[data-theme="dark"] .calc-orange {
  background: var(--dark-orange-bg);
  color: var(--dark-orange-fg);
}

:root[data-theme="dark"] .calc-danger {
  background: var(--dark-error-bg);
  color: var(--dark-error-fg);
}

:root[data-theme="dark"] .calc-dark {
  background: var(--dark-dark-bg);
  color: var(--dark-dark-fg);
}

:root[data-theme="dark"] .sod-simple-value {
  color: var(--dark-link-hover);
}

/* Slider values need higher contrast in dark mode (WCAG AA 4.5:1) */
:root[data-theme="dark"] .calc-slider-value {
  color: #a5b4fc;
}

/* Search highlight - dark mode (ensure dark text on light yellow background for WCAG 1.4.3) */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) mark {
    color: #111827;
  }
}

:root[data-theme="dark"] mark {
  color: #111827;
}

/* ==========================
   High Contrast Mode (WCAG 1.4.11)
   Enhanced for users who prefer increased contrast
   Triggers via: @media (prefers-contrast: more) OR [data-contrast="more"] on :root
   To test manually: document.documentElement.setAttribute('data-contrast', 'more')
   ========================== */

@media (prefers-contrast: more) {
  :root {
    /* Increase border visibility */
    --border: rgb(0 0 0 / 50%);

    /* Increase shadow visibility */
    --shadow-light: rgb(0 0 0 / 25%);
    --shadow-medium: rgb(0 0 0 / 35%);
  }

  /* Enhanced focus indicators */
  :focus-visible {
    outline: 3px solid #000 !important;
    outline-offset: 3px !important;
  }

  /* Enhanced button contrast */
  .btn,
  button {
    border-width: 2px;
  }

  .btn.outline,
  button.outline {
    border-color: var(--fg);
  }

  /* Enhanced card borders and remove subtle background variations */
  .card,
  .section-card,
  .category-card {
    border-width: 2px;
    border-color: var(--fg);
    background: var(--bg);
  }

  /* Enhanced input borders */
  input[type='text'],
  input[type='email'],
  textarea,
  select {
    border-width: 2px;
    border-color: var(--fg);
  }

  /* Ensure links are underlined */
  a:not(.btn, .brand, .category-card) {
    text-decoration: underline;
  }

  /* Icon buttons need explicit borders (they have border: none by default) */
  .vote-btn {
    border: 2px solid var(--fg);
  }

  .theme-toggle,
  .export-toggle {
    border-width: 2px;
    border-color: var(--fg);
  }
}

/* High contrast in dark mode */
@media (prefers-contrast: more) and (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) {
    --border: rgb(255 255 255 / 50%);
  }

  :root:not([data-theme="light"]) :focus-visible {
    outline-color: #fff !important;
  }

  :root:not([data-theme="light"]) .btn.outline,
  :root:not([data-theme="light"]) button.outline {
    border-color: var(--fg);
  }

  :root:not([data-theme="light"]) .card,
  :root:not([data-theme="light"]) .section-card,
  :root:not([data-theme="light"]) .category-card {
    border-color: var(--fg);
  }

  :root:not([data-theme="light"]) input[type='text'],
  :root:not([data-theme="light"]) input[type='email'],
  :root:not([data-theme="light"]) textarea,
  :root:not([data-theme="light"]) select {
    border-color: var(--fg);
  }
}

@media (prefers-contrast: more) {
  :root[data-theme="dark"] {
    --border: rgb(255 255 255 / 50%);
  }

  :root[data-theme="dark"] :focus-visible {
    outline-color: #fff !important;
  }

  :root[data-theme="dark"] .btn.outline,
  :root[data-theme="dark"] button.outline {
    border-color: var(--fg);
  }

  :root[data-theme="dark"] .card,
  :root[data-theme="dark"] .section-card,
  :root[data-theme="dark"] .category-card {
    border-color: var(--fg);
  }

  :root[data-theme="dark"] input[type='text'],
  :root[data-theme="dark"] input[type='email'],
  :root[data-theme="dark"] textarea,
  :root[data-theme="dark"] select {
    border-color: var(--fg);
  }
}

/* Manual high contrast toggle via data attribute (for testing) */
:root[data-contrast="more"] {
  --border: rgb(0 0 0 / 50%);
  --shadow-light: rgb(0 0 0 / 25%);
  --shadow-medium: rgb(0 0 0 / 35%);
}

:root[data-contrast="more"] :focus-visible {
  outline: 3px solid #000 !important;
  outline-offset: 3px !important;
}

:root[data-contrast="more"] .btn,
:root[data-contrast="more"] button {
  border-width: 2px;
}

:root[data-contrast="more"] .btn.outline,
:root[data-contrast="more"] button.outline {
  border-color: var(--fg);
}

:root[data-contrast="more"] .card,
:root[data-contrast="more"] .section-card,
:root[data-contrast="more"] .category-card {
  border-width: 2px;
  border-color: var(--fg);
  background: var(--bg);
}

:root[data-contrast="more"] input[type='text'],
:root[data-contrast="more"] input[type='email'],
:root[data-contrast="more"] textarea,
:root[data-contrast="more"] select {
  border-width: 2px;
  border-color: var(--fg);
}

:root[data-contrast="more"] a:not(.btn, .brand, .category-card) {
  text-decoration: underline;
}

/* Icon buttons need explicit borders in high contrast (they have border: none by default) */
:root[data-contrast="more"] .vote-btn {
  border: 2px solid var(--fg);
}

:root[data-contrast="more"] .theme-toggle,
:root[data-contrast="more"] .export-toggle {
  border-width: 2px;
  border-color: var(--fg);
}

/* High contrast + dark mode via data attribute */
:root[data-contrast="more"][data-theme="dark"],
:root[data-contrast="more"]:not([data-theme="light"]) {
  --border: rgb(255 255 255 / 50%);
}

:root[data-contrast="more"][data-theme="dark"] :focus-visible,
:root[data-contrast="more"]:not([data-theme="light"]) :focus-visible {
  outline-color: #fff !important;
}

:root[data-contrast="more"][data-theme="dark"] .btn.outline,
:root[data-contrast="more"][data-theme="dark"] button.outline,
:root[data-contrast="more"]:not([data-theme="light"]) .btn.outline,
:root[data-contrast="more"]:not([data-theme="light"]) button.outline {
  border-color: var(--fg);
}

:root[data-contrast="more"][data-theme="dark"] .card,
:root[data-contrast="more"][data-theme="dark"] .section-card,
:root[data-contrast="more"][data-theme="dark"] .category-card,
:root[data-contrast="more"]:not([data-theme="light"]) .card,
:root[data-contrast="more"]:not([data-theme="light"]) .section-card,
:root[data-contrast="more"]:not([data-theme="light"]) .category-card {
  border-color: var(--fg);
}

:root[data-contrast="more"][data-theme="dark"] input[type='text'],
:root[data-contrast="more"][data-theme="dark"] input[type='email'],
:root[data-contrast="more"][data-theme="dark"] textarea,
:root[data-contrast="more"][data-theme="dark"] select,
:root[data-contrast="more"]:not([data-theme="light"]) input[type='text'],
:root[data-contrast="more"]:not([data-theme="light"]) input[type='email'],
:root[data-contrast="more"]:not([data-theme="light"]) textarea,
:root[data-contrast="more"]:not([data-theme="light"]) select {
  border-color: var(--fg);
}

# Rate Limiting Configuration for Murphy's Laws
# Add this to /etc/nginx/nginx.conf in the http {} block

# Define rate limit zones
# General application rate limit: 10 requests per second per IP
limit_req_zone $binary_remote_addr zone=app_limit:10m rate=10r/s;

# API rate limit: 5 requests per second per IP (stricter for API)
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=5r/s;

# Login/Auth rate limit: 2 requests per minute per IP (very strict)
limit_req_zone $binary_remote_addr zone=auth_limit:10m rate=2r/m;

# POST request rate limit: 3 requests per second per IP
limit_req_zone $binary_remote_addr zone=post_limit:10m rate=3r/s;

# Calculator rate limit: 10 requests per minute per IP (prevent abuse)
limit_req_zone $binary_remote_addr zone=calculator_limit:10m rate=10r/m;

# Define connection limits
# Limit concurrent connections per IP
limit_conn_zone $binary_remote_addr zone=conn_limit:10m;

# Request body size limits
client_body_buffer_size 128k;
client_max_body_size 10m;
client_header_buffer_size 1k;
large_client_header_buffers 4 4k;

# Timeouts to prevent slowloris attacks
client_body_timeout 12;
client_header_timeout 12;
keepalive_timeout 15;
send_timeout 10;

# Logging for rate limited requests
limit_req_log_level warn;
limit_req_status 429;
limit_conn_status 429;
